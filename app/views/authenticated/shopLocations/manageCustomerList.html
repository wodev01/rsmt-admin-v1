<md-sidenav id="customer-list-side-nav"
            class="md-sidenav-right md-whiteframe-z2 right-side-nav" md-component-id="manageCustomerListView">

    <!-- swapping view header -->
    <md-toolbar class="light-black-bg-1">
        <div class="md-toolbar-tools" layout="row">
            <span ng-bind="$root.isCustomerListName ? $root.isCustomerListName : 'Create New List' "></span>
            <span flex></span>
            <md-button class="md-raised md-accent"
                       ng-click="$root.fnCloseManageCustomerListView();">Back</md-button>
        </div>
    </md-toolbar>

    <md-content ng-controller="manageCustomerListCtrl" ng-init="fnInit();" layout-padding>
        <form name="searchForm" layout="column" novalidate>
            <div layout="row">
                <md-input-container class="remove-error-space" flex>
                    <label>Customer List Name</label>
                    <input type="text" name="name" ng-model="filterObj.name" required/>

                    <div ng-if="searchForm.$submitted || searchForm.name.$touched">
                        <span class="error-msg" ng-if="searchForm.name.$error.required">List name is required.</span>
                    </div>
                </md-input-container>

                <div>
                    <md-checkbox class="md-accent"
                                 aria-label="Checkbox No Ink"
                                 ng-disabled="isProcessing"
                                 ng-model="filterObj.customers_only" md-no-ink>Customers Only
                    </md-checkbox>

                    <md-button class="md-raised md-accent margin-top-13 margin-right-0" type="submit"
                               aria-label="Add to customer list"
                               ng-disabled="isProcessing"
                               ng-click="searchForm.$valid && fnAddExprToCustomerList(filterObj);">
                        <span ng-bind="$root.isCustomerListName ? 'Update' : 'Add To Customer List'"></span>
                    </md-button>
                </div>
            </div>
        </form>

        <form name="expressionForm" novalidate>
            <div layout="row" layout-xs="column" layout-align="space-between center" novalidate>
                <div layout="row" layout-fill flex>
                    <md-input-container flex>
                        <md-select aria-label="Select operand1"
                                   name="filterName"
                                   ng-model="filter.name"
                                   placeholder="-- Select Option --" required>
                            <md-option ng-repeat="operand1 in customerListFilterOptions" ng-value="operand1">
                                {{operand1}}
                            </md-option>
                        </md-select>
                        <div ng-if="expressionForm.$submitted || expressionForm.filterName.$touched">
                            <span class="error-msg" ng-if="expressionForm.filterName.$error.required">Filter name is required.</span>
                        </div>
                    </md-input-container>

                    <md-input-container flex>
                        <md-select aria-label="Select operator"
                                   name="filterOperator"
                                   ng-model="filter.operator"
                                   placeholder="-- Select Option --" required>
                            <md-option ng-repeat="operator in operatorDD" ng-value="operator.value">
                                {{operator.label}}
                            </md-option>
                        </md-select>
                        <div ng-if="expressionForm.$submitted || expressionForm.filterOperator.$touched">
                            <span class="error-msg" ng-if="expressionForm.filterOperator.$error.required">Operator is required.</span>
                        </div>
                    </md-input-container>
                </div>

                <div layout="row" layout-fill flex>
                    <div layout="column" flex>
                        <md-autocomplete
                                md-input-name="autocomplete"
                                md-search-text="filter.searchText"
                                md-selected-item="filter.value"
                                md-items="item in fnGetFilteredValues(filter.searchText, filter.name)"
                                md-item-text="item"
                                md-delay="500"
                                md-no-cache="true"
                                md-min-length="0"
                                placeholder="Search/Type values" required="true" flex>
                            <md-item-template>
                                <span md-highlight-text="filter.searchText" md-highlight-flags="^i">{{item}}</span>
                            </md-item-template>
                        </md-autocomplete>
                        <div class="error-msg margin-top-3"
                             ng-if="expressionForm.$submitted && !filter.searchText">
                            This field is required.
                        </div>
                    </div>

                    <md-button class="md-fab md-mini margin-top-0 margin-bottom-13" type="submit"
                               ng-disabled="isProcessing"
                               ng-click="expressionForm.$valid && filter.searchText && fnAddExpression(filter);">
                        <md-icon md-font-set="material-icons">add</md-icon>
                        <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Add Expression</md-tooltip>
                    </md-button>
                </div>
            </div>
        </form>

        <md-divider></md-divider>

        <div layout="row" layout-xs="column" layout-align="space-between center"
             ng-repeat="expr in expressionArr">
            <div class="margin-top-8 margin-right-8">{{$index + 1}}.</div>
            <div layout="row" layout-fill flex>
                <md-input-container flex>
                    <md-select aria-label="Select operand1"
                               name="exprName"
                               ng-model="expr.name"
                               ng-disabled="isProcessing"
                               placeholder="-- Select Option --">
                        <md-option ng-repeat="operand1 in customerListFilterOptions" ng-value="operand1">
                            {{operand1}}
                        </md-option>
                    </md-select>
                </md-input-container>

                <md-input-container flex>
                    <md-select aria-label="Select operator"
                               name="exprOperator"
                               ng-model="expr.operator"
                               ng-disabled="isProcessing"
                               placeholder="-- Select Option --">
                        <md-option ng-repeat="operator in operatorDD" ng-value="operator.value">
                            {{operator.label}}
                        </md-option>
                    </md-select>
                </md-input-container>
            </div>

            <div layout="row" layout-fill flex>
                <div layout="column" flex>
                    <md-autocomplete
                            md-search-text="expr.searchText"
                            md-selected-item="expr.value"
                            md-items="item in fnGetFilteredValues(expr.searchText, expr.name)"
                            md-item-text="item"
                            md-delay="500"
                            md-no-cache="true"
                            md-min-length="0"
                            ng-disabled="isProcessing"
                            placeholder="Search/Type values" flex>
                        <md-item-template>
                            <span md-highlight-text="expr.searchText" md-highlight-flags="^i">{{item}}</span>
                        </md-item-template>
                    </md-autocomplete>
                </div>

                <md-button class="md-icon-button md-warn"
                           style="margin-bottom: 13px;"
                           ng-disabled="isProcessing"
                           ng-click="fnDeleteRow($index);">
                    <md-icon md-font-set="material-icons">delete</md-icon>
                    <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip>
                </md-button>
            </div>
        </div>

        <div layout="row">
            <md-button class="md-raised md-accent margin-left-0" type="submit"
                       aria-label="Preview values"
                       ng-disabled="isProcessing"
                       ng-click="showPreview=true; fnGetPreviewValues(filterObj);">
                Preview values
            </md-button>
        </div>


        <div layout="column" md-theme="grey" ng-if="showPreview">
            <ul class="breadcrumb">
                <li ng-repeat="breadcrumb in breadcrumbArr" ng-click="fnOnSelectBreadcrumb($index)">
                    <a href="javascript:void(0);">{{breadcrumb.name}}</a>
                </li>
            </ul>

            <div ng-if="customerIndex == 0">
                <!-- Loader -->
                <div ng-if="isPreviewData" layout="column" layout-align="center center"
                     layout-fill flex>
                    <md-progress-circular class="md-accent" md-diameter="100"
                                          md-mode="indeterminate"></md-progress-circular>
                </div>

                <div ng-if="customerPreviewData.length == 0 && isPreviewDataMsg" layout="row"
                     layout-align="center center">
                    <div class="md-headline">Preview data not available.</div>
                </div>

                <!-- Grid Section -->
                <div class="margin-bottom-10" ng-if="customerPreviewData.length !== 0 && !isPreviewData">
                    <div ui-grid="previewListGridOptions" ui-grid-selection ui-grid-auto-resize
                         ng-style="$root.fnReturnGridHeight(customerPreviewData.length);" ng-cloak></div>
                </div>
            </div>

            <div ng-if="customerIndex == 1">
                <!-- Customer Info-->
                <div class="md-whiteframe-10dp">
                    <md-toolbar class="md-primary md-hue-1">
                        <div class="md-toolbar-tools" layout layout-align="center center">
                            <span class="md-title">Customer Info</span>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Name:</label>
                            <label flex>{{customer.first_name}}&nbsp;{{customer.last_name}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Company:</label>
                            <label flex>{{customer.company}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Address 1:</label>
                            <label flex>{{customer.address1}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Postal Code:</label>
                            <label flex>{{customer.postal_code}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">City:</label>
                            <label flex>{{customer.city}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Phone Numbers:</label>
                            <label flex>{{customer.phone_numbers | joinTelArray}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">State:</label>
                            <label flex>{{customer.state}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Email:</label>
                            <label flex>{{customer.email_addresses | joinArray}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">SMS_CRM_Active:</label>
                            <label flex>{{customer.sms_crm_active}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Email Unsubscribed:</label>
                            <label flex>{{customer.email_unsubscribed}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Vehicle RO Count:</label>
                            <label flex>{{customer.vehicle_ro_count}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Vehicle Total Spent:</label>
                            <label flex>{{customer.vehicle_total_spent}}</label>
                        </div>
                    </div>
                </div>

                <!-- Vehicles Info-->
                <div class="md-whiteframe-10dp">
                    <md-toolbar class="md-primary md-hue-1">
                        <div class="md-toolbar-tools" layout layout-align="center center">
                            <span class="md-title">Vehicles Info</span>
                        </div>
                    </md-toolbar>

                    <div style="overflow: auto"> <!--max-height: 350px-->
                        <div layout="column" layout-sm="column" layout-margin>
                            <div layout="row" layout-sm="column">
                                <div class="datagrid">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th>Model</th>
                                            <th>Make</th>
                                            <th>License</th>
                                            <th>Year</th>
                                            <th>Color</th>
                                            <th>Odometer</th>
                                            <th>Notes</th>
                                            <th>Reference</th>
                                            <th>&nbsp;</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="val in customer.vehicles"
                                            ng-class="{'selected':$index == selectedRow}"
                                            ng-click="setClickedRow($index)">
                                            <td>{{val.model}}</td>
                                            <td>{{val.make}}</td>
                                            <td>{{val.license}}</td>
                                            <td>{{val.year}}</td>
                                            <td>{{val.color}}</td>
                                            <td>{{val.last_odo}}</td>
                                            <td>{{val.notes}}</td>
                                            <td>{{val.reference}}</td>
                                            <td>
                                                <div layout="row">
                                                    <md-button class="md-icon-button md-accent"
                                                               ng-click="fnViewVehicleDetails(val); setClickedRow($index);">
                                                        <md-icon md-font-set="material-icons">launch</md-icon>
                                                        <md-tooltip ng-if="$root.isMobile === null" md-direction="top">
                                                            View
                                                        </md-tooltip>
                                                    </md-button>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div ng-if="customerIndex == 2">
                <!-- Vehicles Info-->
                <div class="md-whiteframe-10dp">
                    <md-toolbar class="md-primary md-hue-1">
                        <div class="md-toolbar-tools" layout layout-align="center center">
                            <span class="md-title">Vehicles Info</span>
                        </div>
                    </md-toolbar>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Model:</label>
                            <label flex>{{vehicleObj.model}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Make:</label>
                            <label flex>{{vehicleObj.make}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Licenses:</label>
                            <label flex>{{vehicleObj.license}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Year:</label>
                            <label flex>{{vehicleObj.year}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Color:</label>
                            <label flex>{{vehicleObj.color}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Odometer:</label>
                            <label flex>{{vehicleObj.last_odo}}</label>
                        </div>
                    </div>

                    <div layout="row" layout-xs="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Notes:</label>
                            <label flex>{{vehicleObj.notes}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Reference:</label>
                            <label flex>{{vehicleObj.reference}}</label>
                        </div>
                    </div>
                </div>

                <div class="md-whiteframe-10dp margin-bottom-10">
                    <md-toolbar class="md-primary md-hue-1">
                        <div class="md-toolbar-tools" layout layout-align="center center">
                            <span class="md-title">Recommended Items</span>
                        </div>
                    </md-toolbar>
                    <recommended-grid vehicle-id="vehicleObj.id"></recommended-grid>
                </div>

                <div class="md-whiteframe-10dp">
                    <md-toolbar class="md-primary md-hue-1">
                        <div class="md-toolbar-tools" layout layout-align="center center">
                            <span class="md-title">Repair Orders</span>
                        </div>
                    </md-toolbar>
                    <repair-order-grid vehicle-id="vehicleObj.id"></repair-order-grid>
                </div>
            </div>
        </div>
    </md-content>
</md-sidenav>